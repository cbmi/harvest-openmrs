var __hasProp={}.hasOwnProperty,__extends=function(t,n){function r(){this.constructor=t}for(var e in n)__hasProp.call(n,e)&&(t[e]=n[e]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};define(["underscore","backbone","../core","./base"],function(t,n,r,e){var o,s,i,u;return o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.idAttribute="concept",n}(n.Model),s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.model=o,n}(n.Collection),u=function(n){function e(){this.facets=new s,this.on("change:json",function(t,n){return this.jsonToFacets(n)}),e.__super__.constructor.apply(this,arguments)}return __extends(e,n),e.prototype.initialize=function(){return this.on("request",function(){return r.trigger(r.VIEW_SYNCING,this)}),this.on("sync",function(t,n,e){return null==e&&(e={}),e.silent!==!0?r.trigger(r.VIEW_SYNCED,this,"success"):void 0}),this.on("error",function(){return r.trigger(r.VIEW_SYNCED,this,"error")}),this.on("change",function(){return r.trigger(r.VIEW_CHANGED,this)}),r.on(r.VIEW_SAVE,function(t){return function(n){return t.id===n||!n&&t.isSession()?t.save():void 0}}(this))},e.prototype.isSession=function(){return this.get("session")},e.prototype.isArchived=function(){return this.get("archived")},e.prototype.toJSON=function(){var t;return t=e.__super__.toJSON.apply(this,arguments),t.json=this.facetsToJSON(),t},e.prototype.parse=function(t){return e.__super__.parse.apply(this,arguments),this.jsonToFacets(t.json),t},e.prototype.jsonToFacets=function(n){var r,e,o,s,i,u,c,p,_,a,h,f,l;if(null==n&&(n={}),t.isArray(n))return void this.facets.reset(n);for(i=[],e=n.columns||[],u=n.ordering||[],p=0,h=e.length;h>p;p++){for(s=e[p],r={concept:s},o=a=0,f=u.length;f>a;o=++a)l=u[o],_=l[0],c=l[1],s===_&&(r.sort=c,r.sort_index=o);i.push(r)}return this.facets.reset(i)},e.prototype.facetsToJSON=function(){var t;return t={ordering:[],columns:[]},this.facets.each(function(n){var r,e,o;return t.columns.push(n.get("concept")),(r=n.get("sort"))?(e=n.get("sort_index"),o=[n.get("concept"),r],t.ordering.splice(e,0,o)):void 0}),t},e}(e.Model),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.model=u,n}(e.SessionCollection),{ViewModel:u,ViewCollection:i}});
//# sourceMappingURL=view.js.map