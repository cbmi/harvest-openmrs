var __hasProp={}.hasOwnProperty,__extends=function(t,e){function o(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},__indexOf=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1},__bind=function(t,e){return function(){return t.apply(e,arguments)}},__slice=[].slice;define(["underscore","backbone","marionette","./base","../button"],function(t,e,o,r){var n,i,s,l,c,u,a;return a=function(e){return function(o){var r;return r=o.get(e),t.isString(r)&&(r=r.toLowerCase()),r}},l=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.parse=function(t){return t.value=t.values[0],t},e}(e.Model),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.model=l,e.prototype.comparator=function(t){return-t.get("count")},e.prototype.sortModelsBy=function(t){var e;(e="-"===t.charAt(0))&&(t=t.slice(1)),this.models=this.sortBy(a(t)),e&&this.models.reverse(),this.trigger("sort",this)},e}(e.Collection),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.className="info-bar",e.prototype.template="controls/infograph/bar",e.prototype.options={total:null},e.prototype.ui={bar:".bar"},e.prototype.events={click:"toggleSelected"},e.prototype.modelEvents={"change:selected":"setSelected","change:visible":"setVisible","change:excluded":"setExcluded"},e.prototype.serializeData=function(){var t,e;return t=this.model.toJSON(),t.value=t.values[0],e=this.getPercentage(),t.width=e,t.percentage=1>e?"<1":parseInt(e),t},e.prototype.onRender=function(){return this.setSelected(this.model,!!this.model.get("selected"))},e.prototype.getPercentage=function(){return this.model.get("count")/this.options.total*100},e.prototype.toggleSelected=function(){return this.model.set("selected",!this.model.get("selected"))},e.prototype.setExcluded=function(t,e){return this.$el.toggleClass("excluded",e)},e.prototype.setSelected=function(t,e){return this.$el.toggleClass("selected",e),e||t.get("visible")!==!1?void 0:this.$el.removeClass("filtered").hide()},e.prototype.setVisible=function(t,e){return e?this.$el.removeClass("filtered").show():t.get("selected")?this.$el.addClass("filtered"):this.$el.hide()},e}(o.ItemView),c=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,e),o.prototype.className="info-bar-chart",o.prototype.itemView=n,o.prototype.itemViewOptions=function(t){return{model:t,total:this.calcTotal()}},o.prototype.collectionEvents={change:"change",sort:"sortChildren"},o.prototype.initialize=function(){return this.wait(),this.model.distribution(function(t){return function(e){return t.collection.reset(e.data,{parse:!0}),t.ready()}}(this))},o.prototype.calcTotal=function(){var t,e,o,r,n;for(e=0,n=this.collection.pluck("count"),o=0,r=n.length;r>o;o++)t=n[o],e+=t;return e},o.prototype.sortChildren=function(){this.collection.each(function(t){return function(e){var o;return o=t.children.findByModel(e),t.$el.append(o.el)}}(this))},o.prototype.getField=function(){return this.model.id},o.prototype.getOperator=function(){return this.collection.where({excluded:!0}).length>0?"-in":"in"},o.prototype.getValue=function(){return t.map(this.collection.where({selected:!0}),function(t){return t.get("value")})},o.prototype.setValue=function(t){null==t&&(t=[]),this.collection.each(function(e){var o;return e.set("selected",(o=e.get("value"),__indexOf.call(t,o)>=0))})},o.prototype.setOperator=function(t){"-in"===t&&(this.collection.each(function(t){return t.set("excluded",!0)}),$("input[name=exclude]").attr("checked",!0))},o}(r.ControlCollectionView),i=function(e){function o(){return this.toggle=__bind(this.toggle,this),o.__super__.constructor.apply(this,arguments)}return __extends(o,e),o.prototype.className="navbar navbar-toolbar",o.prototype.template="controls/infograph/toolbar",o.prototype.events={"keyup [name=filter]":"filterBars","click [name=invert]":"invertSelection","click .sort-value-header, .sort-count-header":"sortBy","change [name=exclude]":"excludeCheckboxChanged"},o.prototype.ui={toolbar:".btn-toolbar",filterInput:"[name=filter]",invertButton:"[name=invert]",sortValueHeader:".sort-value-header",sortCountHeader:".sort-count-header",excludeCheckbox:"[name=exclude]"},o.prototype.initialize=function(){return this.sortDirection="-count"},o.prototype.sortBy=function(t){switch(this.sortDirection="sort-value-header"===t.currentTarget.className?"-value"===this.sortDirection?"value":"-value":"-count"===this.sortDirection?"count":"-count",this.sortDirection){case"-count":this.ui.sortValueHeader.html("Value <i class=icon-sort></i>"),this.ui.sortCountHeader.html("Count <i class=icon-sort-down></i>");break;case"count":this.ui.sortValueHeader.html("Value <i class=icon-sort></i>"),this.ui.sortCountHeader.html("Count <i class=icon-sort-up></i>");break;case"-value":this.ui.sortValueHeader.html("Value <i class=icon-sort-down></i>"),this.ui.sortCountHeader.html("Count <i class=icon-sort></i>");break;case"value":this.ui.sortValueHeader.html("Value <i class=icon-sort-up></i>"),this.ui.sortCountHeader.html("Count <i class=icon-sort></i>")}return this.collection.sortModelsBy(this.sortDirection)},o.prototype.toggle=function(t){return this.ui.filterInput.toggle(t),this.ui.invertButton.toggle(t),this.ui.sortValueHeader.toggle(t),this.ui.sortCountHeader.toggle(t)},o.prototype.filterBars=function(e){var o,r;t.isString(e)?r=e:(null!=e&&e.stopPropagation(),r=this.ui.filterInput.val()),o=new RegExp(r,"i"),this.collection.each(function(t){return t.set("visible",!r||o.test(t.get("value")))})},o.prototype.invertSelection=function(){this.collection.each(function(t){return t.get("visible")!==!1||t.get("selected")?t.set("selected",!t.get("selected")):void 0}),this.collection.trigger("change")},o.prototype.excludeCheckboxChanged=function(){this.collection.each(function(t){return function(e){return e.set("excluded",t.ui.excludeCheckbox.prop("checked"))}}(this)),this.collection.trigger("change")},o}(o.ItemView),u=function(e){function o(t){this.toggleToolbar=__bind(this.toggleToolbar,this);var e,r,n,i,l;for(null==t.collection&&(t.collection=new s),o.__super__.constructor.call(this,t),this.barsControl=new c({model:this.model,collection:this.collection}),l=["set","get","when","ready","wait"],r=function(t){return function(e){return t[e]=function(){var o,r;return o=1<=arguments.length?__slice.call(arguments,0):[],(r=t.barsControl)[e].apply(r,o)}}}(this),n=0,i=l.length;i>n;n++)e=l[n],r(e);this.listenTo(this.barsControl,"all",function(){var t,e;return e=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],("change"===e||"beforeready"===e||"ready"===e)&&this.trigger.apply(this,[e].concat(__slice.call(t))),"ready"===e?this.ui.loading.hide():void 0})}return __extends(o,e),o.prototype.template="controls/infograph/layout",o.prototype.events={change:"change"},o.prototype.options={minValuesForToolbar:10},o.prototype.regions={bars:".bars-region",toolbar:".toolbar-region"},o.prototype.ui={loading:"[data-target=loading-indicator]"},o.prototype.collectionEvents={reset:"toggleToolbar"},o.prototype.toggleToolbar=function(){return this.toolbar.currentView?this.toolbar.currentView.toggle(this.collection.length>=this.options.minValuesForToolbar):void 0},o.prototype.onRender=function(){return this.bars.show(this.barsControl),this.toolbar.show(new i({collection:this.collection})),this.toggleToolbar()},o.prototype.validate=function(e){return t.isUndefined(e.value)||0===e.value.length?"Select at least one value":void 0},o}(r.ControlLayout),{InfographControl:u}});
//# sourceMappingURL=infograph.js.map